PIC16F887 con Comunicaci√≥n Serial (C++)

#include <xc.h>
#include <stdio.h>
#define _XTAL_FREQ 8000000

void UART_Init(){
    SPBRG=51;
    BRGH=1;
    SYNC=0;
    SPEN=1;
    TXEN=1;
    CREN=1;
}

void UART_Write(char data){
    while(!TRMT);
    TXREG=data;
}

void UART_Text(char *text){
    while(*text) UART_Write(*text++);
}

char UART_Read(){
    while(!RCIF);
    return RCREG;
}

unsigned int convertirDecimal(char *valor, int base){
    unsigned int resultado=0;
    while(*valor){
        resultado*=base;
        if(*valor>='0' && *valor<='9')
            resultado+=*valor-'0';
        else
            resultado+=*valor-'A'+10;
        valor++;
    }
    return resultado;
}

void main(){
    TRISC6=0;
    TRISC7=1;
    UART_Init();

    char valor[5];
    int i;

    while(1){
        UART_Text("\r\nIngrese binario (max4): ");

        for(i=0;i<4;i++){
            valor[i]=UART_Read();
            UART_Write(valor[i]);
            if(valor[i]!='0' && valor[i]!='1'){
                UART_Text("\r\nError caracter");
                break;
            }
        }
        valor[4]='\0';

        unsigned int decimal=convertirDecimal(valor,2);

        if(decimal>15){
            UART_Text("\r\nError rango >15");
        }else{
            UART_Text("\r\nDecimal: ");
            UART_Write(decimal+'0');
        }
    }
}
